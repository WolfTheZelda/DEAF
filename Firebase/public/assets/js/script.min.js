function EnviarArquivo(e,t,a){t=document.getElementById(t);var o=t.src;o=o.substring(o.indexOf("/assets"),o.lastIndexOf("")),t.src=LoadingImage;var n=document.getElementById(e).files[0],i=Database.child(a).push().key,r={contentType:n.type},s=Storage.child(a+i).put(n,r);s.then(e=>e.ref.getDownloadURL()).then(e=>{if(t.src=e,o!=GalleryImage&&o!=LoadingImage){var a=firebase.storage().refFromURL(o);a.delete().then(function(){}).catch(function(e){console.error(e)})}}).catch(e=>{t.src=o,Notificacao("Usuário sem permissão para modificação de arquivos"),console.error(e)})}function ModificarKey(e,t){document.querySelector(e).setAttribute("data-key",t)}function ModificarSource(e,t){document.querySelector(e).src=t}function ResetarForm(e){document.querySelector(e).reset()}function ResetarSelect(e,t,a){if(document.querySelector(e).value!=a){for(i=1;i<t;i++)document.querySelector(e).childNodes[i].removeAttribute("disabled");document.querySelector(e).childNodes[t].setAttribute("disabled","")}}function TabelaRegistros(){RegistrosDados.on("child_added",e=>{DestroyTable(),ListarRegistro(e),CreateTable()}),RegistrosDados.on("child_changed",e=>{DestroyTable(),RemoverLinha(e),ListarRegistro(e),CreateTable()}),RegistrosDados.on("child_removed",e=>{DestroyTable(),RemoverLinha(e),CreateTable()}),RegistrosDados.endAt().limitToLast(1).on("child_added",e=>{ChecarTimestamp(e)})}function ListarRegistro(e){let t=e.val(),a=document.createElement("tr"),o=document.createElement("td"),n=document.createElement("td"),i=document.createElement("td");o.innerHTML=t.timestamp,n.innerHTML=t.registro,i.innerHTML=new Date(t.timestamp).toLocaleString(),a.append(o),a.append(n),a.append(i),a.setAttribute("data-key",e.key),RegistrosLista.append(a)}function TabelaAlunos(){AlunosDados.on("child_added",e=>{DestroyTable(),ListarAluno(e),CreateTable()}),AlunosDados.on("child_changed",e=>{DestroyTable(),RemoverLinha(e),ListarAluno(e),CreateTable()}),AlunosDados.on("child_removed",e=>{DestroyTable(),RemoverLinha(e),CreateTable()})}function ListarAluno(e){let t=e.val(),a=document.createElement("tr"),o=document.createElement("td"),n=document.createElement("td"),i=document.createElement("td"),r=document.createElement("td"),s=document.createElement("td"),d=document.createElement("td"),l=document.createElement("a"),c=document.createElement("td"),u=document.createElement("button"),m=document.createElement("td"),g=document.createElement("button");o.innerHTML=t.nome,n.innerHTML=t.ano,i.innerHTML=t.colegio,r.innerHTML=t.grupo,s.innerHTML=t.nota,a.append(o),a.append(n),a.append(i),a.append(r),a.append(s),l.innerHTML=e.key,l.className="btn waves-effect waves-light green",l.setAttribute("target","_blank"),l.setAttribute("href","https://wa.me/"+e.key.replace("+","")),d.append(l),a.append(d),u.className="btn waves-effect waves-light blue aluno-mostrar-button",u.innerHTML="Mostrar",u.addEventListener("click",MostrarAluno),c.append(u),a.append(c),g.className="btn waves-effect waves-light red aluno-deletar-button",g.innerHTML="Deletar",g.addEventListener("click",DeletarAluno),g.setAttribute("data-path","/alunos/"),m.append(g),a.append(m),a.setAttribute("data-key",e.key),AlunosLista.append(a)}function MostrarAluno(e){var t=e.target.closest("tr").getAttribute("data-key"),a=Database.child("/alunos/"+t);AlunoPagina.setAttribute("data-key",t),ChangePage(AlunoPagina),a.on("value",e=>{let t=e.val(),a=document.getElementById("aluno-nome"),o=document.getElementById("aluno-ano"),n=document.getElementById("aluno-colegio"),i=document.getElementById("aluno-grupo"),r=document.getElementById("aluno-nota"),s=document.getElementById("aluno-telefone"),d=document.getElementById("aluno-foto-imagem");a.value=t.nome,o.value=t.ano,n.value=t.colegio,i.value=t.grupo,r.value=t.nota,$(s).val(e.key).trigger("input"),d.setAttribute("src",t.foto),""!=t.foto&&null!=t.foto||d.setAttribute("src",GalleryImage)})}function DeletarAluno(e){var t=e.target.closest("tr").getAttribute("data-key"),a=e.target.getAttribute("data-path"),o=Database.child(a+t);o.once("value",e=>{Registrar("O administrador "+Vue.UserName+" removeu o aluno "+e.val().nome+" com a nota "+e.val().nota)}).then(function(){o.remove(),console.log("Remove succeeded.")})}function EditarAluno(){var e=AlunoPagina.getAttribute("data-key");let t=document.getElementById("aluno-nome"),a=document.getElementById("aluno-ano"),o=document.getElementById("aluno-colegio"),n=document.getElementById("aluno-grupo"),i=document.getElementById("aluno-nota"),r="+"+document.getElementById("aluno-telefone").value.replace(/[^0-9]/g,""),s=document.getElementById("aluno-foto-imagem");if(s.src!=LoadingImage){var d,l={nome:NomeMask(t.value),ano:a.value,colegio:o.value,grupo:n.value,nota:i.value,foto:s.src};null!=e&&"null"!=e?(d=Database.child("/alunos/"+r),d.update(l),Registrar("O administrador "+Vue.UserName+" atualizou o aluno "+t.value+" com a nota "+i.value),e!=r&&(d=Database.child("/alunos/"+e),d.remove())):Database.child("alunos").child(r).once("value",function(e){e.exists()?Notificacao("Já existe um aluno com esse telefone"):(d=Database.child("/alunos/"+r),d.set(l),Registrar("O administrador "+Vue.UserName+" adicionou o aluno "+t.value+" com a nota "+i.value))}),s.src=GalleryImage,ChangePage(Alunos)}}function TabelaAdministradores(){AdministradoresDados.on("child_added",e=>{DestroyTable(),ListarAdministrador(e),CreateTable()}),AdministradoresDados.on("child_changed",e=>{DestroyTable(),RemoverLinha(e),ListarAdministrador(e),CreateTable()}),AdministradoresDados.on("child_removed",e=>{DestroyTable(),RemoverLinha(e),CreateTable()})}function DeletarAdministrador(e){var t=e.target.closest("tr").getAttribute("data-key"),a=e.target.getAttribute("data-path"),o=Database.child(a+t);o.once("value",e=>{Registrar("O administrador "+Vue.UserName+" removeu o administrador "+e.val().nome+" com o telefone "+e.key)}),o.remove()}function ListarAdministrador(e){let t=e.val(),a=document.createElement("tr"),o=document.createElement("td"),n=document.createElement("td"),i=document.createElement("td"),r=document.createElement("td"),s=document.createElement("td"),d=document.createElement("td"),l=document.createElement("a"),c=document.createElement("td"),u=document.createElement("button"),m=document.createElement("td"),g=document.createElement("button");o.innerHTML=t.nome,n.innerHTML=t.ano,i.innerHTML=t.colegio,r.innerHTML=t.grupo,s.innerHTML=t.nota,a.append(o),a.append(n),a.append(i),a.append(r),a.append(s),l.innerHTML=e.key,l.className="btn waves-effect waves-light green",l.setAttribute("target","_blank"),l.setAttribute("href","https://wa.me/"+e.key.replace("+","")),d.append(l),a.append(d),u.className="btn waves-effect waves-light blue administrador-mostrar-button",u.innerHTML="Mostrar",u.addEventListener("click",MostrarAdministrador),c.append(u),a.append(c),g.innerHTML="Deletar","Desenvolvedor"!=t.grupo?(g.className="btn waves-effect waves-light red administrador-deletar-button",g.addEventListener("click",DeletarAdministrador)):g.className="btn waves-effect waves-light red administrador-deletar-button disabled",g.setAttribute("data-path","/administradores/"),m.append(g),a.append(m),a.setAttribute("data-key",e.key),AdministradoresLista.append(a)}function MostrarAdministrador(e){var t=e.target.closest("tr").getAttribute("data-key"),a=Database.child("/administradores/"+t);AdministradorPagina.setAttribute("data-key",t),ChangePage(AdministradorPagina),a.on("value",e=>{let t=e.val(),a=document.getElementById("administrador-nome"),o=document.getElementById("administrador-ano"),n=document.getElementById("administrador-colegio"),i=document.getElementById("administrador-grupo"),r=document.getElementById("administrador-nota"),s=document.getElementById("administrador-telefone"),d=document.getElementById("administrador-foto-imagem");a.value=t.nome,o.value=t.ano,n.value=t.colegio,i.value=t.grupo,r.value=t.nota,$(s).val(e.key).trigger("input"),d.setAttribute("src",t.foto),""!=t.foto&&null!=t.foto||d.setAttribute("src",GalleryImage),"Desenvolvedor"==i.value?(i.childNodes[1].setAttribute("disabled",""),i.childNodes[2].setAttribute("disabled",""),i.childNodes[3].removeAttribute("disabled")):(i.childNodes[1].removeAttribute("disabled"),i.childNodes[2].removeAttribute("disabled"),i.childNodes[3].setAttribute("disabled",""))})}function EditarAdministrador(){var e=AdministradorPagina.getAttribute("data-key");let t=document.getElementById("administrador-nome"),a=document.getElementById("administrador-ano"),o=document.getElementById("administrador-colegio"),n=document.getElementById("administrador-grupo"),i=document.getElementById("administrador-nota"),r="+"+document.getElementById("administrador-telefone").value.replace(/[^0-9]/g,""),s=document.getElementById("administrador-foto-imagem");if(s.src!=LoadingImage){var d,l={nome:NomeMask(t.value),ano:a.value,colegio:o.value,grupo:n.value,nota:i.value,foto:s.src};null!=e&&"null"!=e?(d=Database.child("/administradores/"+r),d.update(l),Registrar("O administrador "+Vue.UserName+" atualizou o administrador "+t.value+" com o telefone "+r),e!=r&&(d=Database.child("/administradores/"+e),d.remove())):Database.child("administradores").child(r).once("value",function(e){e.exists()?Notificacao("Ja existe um Administrador com esse Telefone"):(d=Database.child("/administradores/"+r),d.set(l),Registrar("O administrador "+Vue.UserName+" adicionou o administrador "+t.value+" com o telefone "+r))}),s.src=GalleryImage,ChangePage(AdministradoresPagina)}}function RemoverLinha(e){document.querySelector("tr[data-key='"+e.key+"']").remove()}function MostrarEsconder(e,t){e.style.display="block",t.style.display="none"}function SetAdminPage(){var e=document.getElementById(Vue.AdminPage);e?document.getElementById(Vue.AdminPage).style.display="block":(document.getElementById("menu").style.display="block",Vue.AdminPage="menu")}function SetStudentPage(){"alunos-adicionar"==GET.p&&GET.q}function ChangePage(e){$("main").children().hide(),$(e).show(),CreateTable()}function Registrar(e){Vue.HasWrite?Database.child("/registros/").push().set({registro:e,timestamp:Date.now()}):Notificacao("Usuário não tem permissão de administrador")}function Notificacao(e){M.toast({html:e})}function ChecarTimestamp(e){var t=(new Date).getTime()-e.val().timestamp;t<=1e3&&(Notificacao(e.val().registro),NotificacaoDesktop(e.val().registro),NotificacaoCordova(e.val().registro))}function LoginRecaptcha(){window.RecaptchaVerificador=new firebase.auth.RecaptchaVerifier("telefone-button",{size:"invisible",callback:function(e){LoginTelefone()}}),RecaptchaVerificador.render().then(function(e){window.RecaptchaWidgetID=e})}function LoginTelefone(){var e=document.getElementById("telefone-input").value,t=window.RecaptchaVerificador;firebase.auth().signInWithPhoneNumber(e,t).then(function(e){window.RecaptchaResultado=e,ChangePage("#senha"),Notificacao("Uma nova senha foi enviada para o telefone"),console.log(e)}).catch(function(e){window.RecaptchaVerificador.render().then(function(e){grecaptcha.reset(e)}),Notificacao("Houve um erro ao enviar a senha para o telefone"),console.error(e)})}function LoginSenha(){var e=document.getElementById("senha-input").value;RecaptchaResultado.confirm(e).then(function(e){Notificacao("Conectado com sucesso"),console.log(e)}).catch(function(e){Notificacao("Erro ao conectar"),console.error(e)})}function LoginDeslogar(){firebase.auth().signOut().then(function(e){Notificacao("Deslogado com sucesso"),console.log(e)}).catch(function(e){Notificacao("Erro ao deslogar"),console.error(e)})}function LoginRedirecionar(){"login"==Vue.Page&&(Vue.HasLogin?window.location.href="/dashboard":LoginRecaptcha()),"dashboard"==Vue.Page&&(Vue.HasLogin?(TabelaAlunos(),TabelaRegistros(),TabelaAdministradores(),SetAdminPage(),SetEditor()):window.location.href="/login")}function LoginChecar(){firebase.auth().onAuthStateChanged(function(e){if(e){Vue.HasLogin=!0,Database.child("administradores").child(e.phoneNumber).on("value",function(t){t.exists()?(Vue.HasWrite=!0,Vue.UserName=t.val().nome,Vue.UserNote=t.val().nota,$("#app").show()):Database.child("alunos").child(e.phoneNumber).on("value",function(e){e.exists()?(Vue.HasWrite=!1,Vue.UserName=e.val().nome,Vue.UserNote=e.val().nota,$("#app").show()):(Notificacao("Tentativa de acesso não autorizada foi detectada"),LoginDeslogar())})}),Vue.UserId=e.uid,Vue.UserNumber=e.phoneNumber;var t="https://acaofilosofica.web.app/api/checkuser?id="+Vue.UserId+"&phone="+Vue.UserNumber,a=new XMLHttpRequest;a.open("GET",t,!0),a.onload=function(e){4===a.readyState&&(200===a.status?console.log(a.responseText):console.error(a.statusText))},a.onerror=function(e){console.error(a.statusText)},a.send(null)}else Vue.HasLogin=!1;LoginRedirecionar()})}function AudioHover(e,t){t?$("audio")[e].play():$("audio")[e].pause()}function MudarInput(e,t,a,o){for(i=0;i<o.length;i++)$(e).val()==t?("number"==document.querySelector(o[i]).type&&(document.querySelector(o[i]).type="text"),$(o[i]).val(a)):("text"==document.querySelector(o[i]).type&&(document.querySelector(o[i]).type="number"),$(o[i]).val($(o[i]).attr("data-value")))}function NotificacaoDesktop(e){notify.authorize(),notify.show(e)}function NomeMask(e){if(null!=e&&""!=e){for(var t=e.toLowerCase().trim(),a=t.split(" "),o=0;o<a.length;o++){var n=a[o],i=n[0];n=n.length>2?i.toUpperCase()+n.slice(1):i+n.slice(1),a[o]=n}return a.join(" ")}}function Cordova(){window.hasOwnProperty("cordova")&&(document.addEventListener("deviceready",onDeviceReady,!1),eval("require('https://raw.githubusercontent.com/katzer/cordova-plugin-background-mode/master/www/background-mode.js')"),eval("require('https://raw.githubusercontent.com/katzer/cordova-plugin-local-notifications/master/www/local-notification.js')"),cordova.plugins.backgroundMode.enable(),cordova.plugins.backgroundMode.setDefaults({silent:!0}))}function NotificacaoCordova(e){window.hasOwnProperty("cordova")&&cordova.plugins.notification.local.schedule({title:"DEAF",text:e,foreground:!0})}function LoadIframe(){for(var e=document.getElementsByTagName("iframe"),t=0;t<e.length;t++)e[t].getAttribute("data-src")&&e[t].setAttribute("src",e[t].getAttribute("data-src"))}function DestroyTable(){$("table").DataTable().destroy()}function CreateTable(){$("table").DataTable({language:{sEmptyTable:"Nenhum registro encontrado",sInfo:"Mostrando de _START_ até _END_ de _TOTAL_ registros",sInfoEmpty:"Mostrando 0 até 0 de 0 registros",sInfoFiltered:"(Filtrados de _MAX_ registros)",sInfoPostFix:"",sInfoThousands:".",sLengthMenu:"_MENU_ resultados por página",sLoadingRecords:"Carregando...",sProcessing:"Processando...",sZeroRecords:"Nenhum registro encontrado",sSearch:"",oPaginate:{sNext:"Próximo",sPrevious:"Anterior",sFirst:"Primeiro",sLast:"Último"},oAria:{sSortAscending:": Ordenar colunas de forma ascendente",sSortDescending:": Ordenar colunas de forma descendente"}},searching:!0,ordering:!0,info:!1,lengthChange:!1,responsive:!0,autoWidth:!1}).columns.adjust().responsive.recalc(),$.fn.dataTable.ext.errMode="none"}function SetTableEvents(){$("#administradores-lista").bind("click",".administrador-mostrar-button",MostrarAdministrador),$("#administradores-lista").bind("click",".administrador-deletar-button",DeletarAdministrador),$("#alunos-lista").bind("click",".aluno-mostrar-button",MostrarAluno),$("#alunos-lista").bind("click",".aluno-mostrar-button",DeletarAdministrador)}function SetEditor(){var e=new Quill("#editor",{theme:"snow"});e.on("text-change",function(){e.root.innerHTML})}function ListarPostagem(e){let t=e.val(),a=document.createElement("tr"),o=document.createElement("td"),n=document.createElement("td"),i=document.createElement("td"),r=document.createElement("button"),s=document.createElement("td"),d=document.createElement("button");o.innerHTML=t.texto,n.innerHTML=new Date(t.timestamp).toLocaleString(),i.append(r),s.append(d),a.append(o),a.append(n),a.append(i),a.append(s),a.setAttribute("data-key",e.key),PostagensLista.append(a)}function MostrarPostagem(e){var t=e.target.closest("tr").getAttribute("data-key");Database.child("/postagens/"+t);PostagemPagina.setAttribute("data-key",t),ChangePage(PostagemPagina),PostagensDados.on("value",e=>{let t=e.val(),a=document.getElementById("postagem-titulo"),o=(document.getElementById("postagem-editor"),document.getElementById("postagem-foto-imagem"));a.value=t.titulo,o.setAttribute("src",t.foto),""!=t.foto&&null!=t.foto||o.setAttribute("src",GalleryImage)})}function EditarPostagem(){var e=AdministradorPagina.getAttribute("data-key");let t=document.getElementById("administrador-nome"),a=document.getElementById("administrador-ano"),o=document.getElementById("administrador-colegio"),n=document.getElementById("administrador-grupo"),i=document.getElementById("administrador-nota"),r="+"+document.getElementById("administrador-telefone").value.replace(/[^0-9]/g,""),s=document.getElementById("administrador-foto-imagem");if(s.src!=LoadingImage){var d,l={nome:NomeMask(t.value),ano:a.value,colegio:o.value,grupo:n.value,nota:i.value,foto:s.src};null!=e&&"null"!=e?(d=Database.child("/administradores/"+r),d.update(l),Registrar("O administrador "+Vue.UserName+" atualizou o administrador "+t.value+" com o telefone "+r),e!=r&&(d=Database.child("/administradores/"+e),d.remove())):Database.child("administradores").child(r).once("value",function(e){e.exists()?Notificacao("Ja existe um Administrador com esse Telefone"):(d=Database.child("/administradores/"+r),d.set(l),Registrar("O administrador "+Vue.UserName+" adicionou o administrador "+t.value+" com o telefone "+r))}),s.src=GalleryImage,ChangePage(AdministradoresPagina)}}function Update(e){$(".dataTables_filter").removeClass("dataTables_filter").css("padding","5px"),$(".paginate_button").addClass("btn").removeClass("paginate_button").css("margin","5px"),window.requestAnimationFrame(Update)}var Vue=new Vue({el:"#app",data:{Page:location.pathname.split("/").slice(-1)[0].replace(".html",""),HasLogin:!1,HasWrite:!1,UserId:"",UserName:"Usuário",UserNumber:"Telefone",UserNote:"∞",VideoRandom:"https://www.youtube.com/embed?listType=playlist&list=PLwxNMb28XmpeypJMHfNbJ4RAFkRtmAN3P&fs=0&rel=0&showinfo=0&showsearch=0&controls=0&modestbranding=0&autohide=1&autoplay=0&loop=1&disablekb=1&cc_load_policy=1&iv_load_policy=3&cc_lang_pref=pt&origin=https://acaofilosofica.com&index="+Math.floor(34*Math.random())}});M.AutoInit(),LoginChecar();const Performance=firebase.performance(),Storage=firebase.storage().ref(),Database=firebase.database().ref(),AlunoPagina=document.getElementById("aluno"),Alunos=document.getElementById("alunos"),AlunosDados=Database.child("alunos"),AlunosLista=document.getElementById("alunos-lista"),AdministradorPagina=document.getElementById("administrador"),AdministradoresPagina=document.getElementById("administradores"),AdministradoresDados=Database.child("administradores"),AdministradoresLista=document.getElementById("administradores-lista"),RegistrosDados=Database.child("registros"),RegistrosLista=document.getElementById("registros-lista"),PostagensDados=Database.child("postagens"),PostagensLista=document.getElementById("postagens-lista"),GalleryImage="/assets/image/gallery.webp",LoadingImage="/assets/image/loading.webp",PhoneMask="+55 (73) 9 0000-0000",PhoneTrans={translation:{9:{pattern:/9/,fallback:9}}};$("#aluno-telefone").mask(PhoneMask,PhoneTrans),$("#administrador-telefone").mask(PhoneMask,PhoneTrans);var GET=function(e){if(""==e)return{};for(var t={},a=0;a<e.length;++a){var o=e[a].split("=",2);1==o.length?t[o[0]]="":t[o[0]]=decodeURIComponent(o[1].replace(/\+/g," "))}return t}(window.location.search.substr(1).split("&"));$("#telefone-input").mask(PhoneMask,PhoneTrans),window.onload=function(){"dashboard"!=Vue.Page&&$("#app").show(),LoadIframe(),CreateTable()},window.notify={list:[],id:0,compatible:function(){return"undefined"!=typeof Notification||(console.log("Notifications are not available for your browser."),!1)},authorize:function(){notify.compatible()&&Notification.requestPermission(function(e){console.log("Permission to display: "+e)})},showDelayed:function(e){console.log("A notification will be triggered in "+e+" seconds. Try minimising the browser now."),setTimeout(notify.show,1e3*e)},show:function(e){if("undefined"!=typeof Notification){if(notify.compatible()){notify.id++;var t=notify.id;notify.list[t]=new Notification("DEAF - Ação Filosófica",{body:e,tag:t,icon:"/assets/image/icon.png",lang:"",dir:"auto"}),console.log("Notification #"+t+" queued for display"),notify.list[t].onclick=function(){notify.logEvent(t,"clicked")},notify.list[t].onshow=function(){notify.logEvent(t,"showed")},notify.list[t].onerror=function(){notify.logEvent(t,"errored")},notify.list[t].onclose=function(){notify.logEvent(t,"closed")},console.log("Created a new notification ..."),console.log(notify.list[t])}}else notify.log("Notifications are not available for your browser.")},logEvent:function(e,t){console.log("Notification #"+e+" "+t)}},Cordova(),$("img.lazy").Lazy(),$("table").on("column-sizing",()=>{CreateTable()}),$("table").on("responsive-resize",()=>{CreateTable()}),window.requestAnimationFrame(Update);const messaging=firebase.messaging();messaging.requestPermission().then(function(){return console.log("Notification permission granted."),messaging.getToken()}).then(function(e){console.log("token is : "+e)}).catch(function(e){console.log("Unable to get permission to notify.",e)}),messaging.onMessage(function(e){console.log("Message received. ",e)});