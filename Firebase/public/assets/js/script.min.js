function EnviarArquivo(e,t,a){t=document.getElementById(t);let o=t.src;o=o.substring(o.indexOf("/assets"),o.lastIndexOf("")),t.src=LoadingImage;let n=document.getElementById(e).files[0],i=Database.child(a).push().key,r={contentType:n.type},s=Storage.child(a+i).put(n,r);s.then(e=>e.ref.getDownloadURL()).then(e=>{if(t.src=e,o!=GalleryImage&&o!=LoadingImage){let e=firebase.storage().refFromURL(o);e.delete().then(function(){}).catch(function(e){console.error(e)})}}).catch(e=>{t.src=o,Notificacao("Usuário sem permissão para modificação de arquivos"),console.error(e)})}function ModificarKey(e,t){document.querySelector(e).setAttribute("data-key",t)}function ModificarSource(e,t){document.querySelector(e).src=t}function ResetarForm(e){document.querySelector(e).reset()}function ResetarSelect(e,t,a){if(document.querySelector(e).value!=a){for(i=1;i<t;i++)document.querySelector(e).childNodes[i].removeAttribute("disabled");document.querySelector(e).childNodes[t].setAttribute("disabled","")}}function TabelaRegistros(){REGISTROS_DATABASE.on("child_added",e=>{DestroyTable(),ListarRegistro(e),CreateTable()}),REGISTROS_DATABASE.on("child_changed",e=>{DestroyTable(),RemoverLinha(e),ListarRegistro(e),CreateTable()}),REGISTROS_DATABASE.on("child_removed",e=>{DestroyTable(),RemoverLinha(e),CreateTable()})}function ListarRegistro(e){let t=e.val(),a="<tr data-key='"+e.key+"'><td>"+t.timestamp+"</td><td>"+t.registro+"</td><td>"+new Date(t.timestamp).toLocaleString()+"</td></tr>";REGISTROS_LIST.innerHTML+=a}function TabelaAlunos(){AlunosDados.on("child_added",e=>{DestroyTable(),ListarAluno(e)}),AlunosDados.endAt().limitToLast(1).on("child_added",()=>{CreateTable()}),AlunosDados.on("child_changed",e=>{DestroyTable(),RemoverLinha(e),ListarAluno(e)}),AlunosDados.on("child_removed",e=>{DestroyTable(),RemoverLinha(e)})}function ListarAluno(e){let t=e.val(),a="<tr data-key='"+e.key+"'><td>"+t.nome+"</td><td>"+t.ano+"</td><td>"+t.colegio+"</td><td>"+t.grupo+"</td><td>"+t.nota+"</td><td><a class='btn waves-effect waves-light green' href='https://wa.me/"+e.key.replace("+","")+"' target='_blank'>"+e.key+"</a></td><td><button data-key='"+e.key+"' class='btn waves-effect waves-light blue aluno-mostrar-button'>Mostrar</button></td><td><button data-key='"+e.key+"' data-path='/alunos/' class='btn waves-effect waves-light red aluno-deletar-button'>Deletar</button></td></tr>";AlunosLista.innerHTML+=a}function MostrarAluno(e){let t=e,a=Database.child("/alunos/"+t);AlunoPagina.setAttribute("data-key",t),ChangePage(AlunoPagina),a.on("value",e=>{let t=e.val(),a=document.getElementById("aluno-nome"),o=document.getElementById("aluno-ano"),n=document.getElementById("aluno-colegio"),i=document.getElementById("aluno-grupo"),r=document.getElementById("aluno-nota"),s=document.getElementById("aluno-telefone"),d=document.getElementById("aluno-foto-imagem");"null"!==e.key&&(a.value=t.nome,o.value=t.ano,n.value=t.colegio,i.value=t.grupo,r.value=t.nota,$(s).val(e.key).trigger("input"),d.setAttribute("src",t.foto),""!=t.foto&&null!=t.foto||d.setAttribute("src",GalleryImage))})}function DeletarAluno(e,t){if(confirm("Atenção, você está prestes a deletar um aluno!")){let a=e,o=t,n=Database.child(o+a);n.once("value",e=>{Registrar("O(a) administrador(a) "+Vue.UserName+" ("+Vue.UserGroup+") removeu o(a) aluno(a) "+e.val().nome+" ("+e.val().grupo+") com a nota "+e.val().nota)}).then(function(){n.remove(),console.log("Remove succeeded.")})}}function TabelaAdministradores(){AdministradoresDados.on("child_added",e=>{DestroyTable(),ListarAdministrador(e)}),AdministradoresDados.endAt().limitToLast(1).on("child_added",()=>{CreateTable()}),AdministradoresDados.on("child_changed",e=>{DestroyTable(),RemoverLinha(e),ListarAdministrador(e)}),AdministradoresDados.on("child_removed",e=>{DestroyTable(),RemoverLinha(e)})}function DeletarAdministrador(e,t){if(confirm("Atenção, você está prestes a deletar um administrador!")){let a=e,o=t,n=Database.child(o+a);n.once("value",e=>{Registrar("O(a) administrador "+Vue.UserName+" ("+Vue.UserGroup+") removeu o(a) administrador "+e.val().nome+" ("+e.val().grupo+") com a nota "+e.val().nota+" e com o telefone "+e.key)}),n.remove()}}function ListarAdministrador(e){let t=e.val(),a="enabled";switch(t.grupo){case"Desenvolvedor":a="disabled";break;case"Orientador":default:a="enabled"}let o="<tr data-key='"+e.key+"'><td>"+t.nome+"</td><td>"+t.ano+"</td><td>"+t.colegio+"</td><td>"+t.grupo+"</td><td>"+t.nota+"</td><td><a class='btn waves-effect waves-light green' href='https://wa.me/"+e.key.replace("+","")+"' target='_blank'>"+e.key+"</a></td><td><button data-key='"+e.key+"' class='btn waves-effect waves-light blue administrador-mostrar-button'>Mostrar</button></td><td><button data-key='"+e.key+"' data-path='/administradores/' class='btn waves-effect waves-light red administrador-deletar-button "+a+"'>Deletar</button></td></tr>";AdministradoresLista.innerHTML+=o}function MostrarAdministrador(e){let t=e,a=Database.child("/administradores/"+t);AdministradorPagina.setAttribute("data-key",t),ChangePage(AdministradorPagina),a.on("value",e=>{let t=e.val(),a=document.getElementById("administrador-nome"),o=document.getElementById("administrador-ano"),n=document.getElementById("administrador-colegio"),i=document.getElementById("administrador-grupo"),r=document.getElementById("administrador-nota"),s=document.getElementById("administrador-telefone"),d=document.getElementById("administrador-foto-imagem");"null"!==e.key&&(a.value=t.nome,o.value=t.ano,n.value=t.colegio,i.value=t.grupo,r.value=t.nota,$(s).val(e.key).trigger("input"),d.setAttribute("src",t.foto),""!=t.foto&&null!=t.foto||d.setAttribute("src",GalleryImage),"Desenvolvedor"==i.value?(i.childNodes[1].setAttribute("disabled",""),i.childNodes[2].setAttribute("disabled",""),i.childNodes[3].removeAttribute("disabled")):(i.childNodes[1].removeAttribute("disabled"),i.childNodes[2].removeAttribute("disabled"),i.childNodes[3].setAttribute("disabled","")))})}function EditarAdministrador(){let e=AdministradorPagina.getAttribute("data-key"),t=document.getElementById("administrador-nome"),a=document.getElementById("administrador-ano"),o=document.getElementById("administrador-colegio"),n=document.getElementById("administrador-grupo"),i=document.getElementById("administrador-nota"),r="+"+document.getElementById("administrador-telefone").value.replace(/[^0-9]/g,""),s=document.getElementById("administrador-foto-imagem");if(s.src!=LoadingImage){let d,l={nome:NomeMask(t.value),ano:a.value,colegio:o.value,grupo:n.value,nota:i.value,foto:s.src};null!=e&&"null"!=e?(d=Database.child("/administradores/"+r),d.update(l),Registrar("O(a) administrador(a) "+Vue.UserName+" ("+Vue.UserGroup+") atualizou o(a) administrador(a) "+t.value+" ("+n.value+") com a nota "+i.value+" e com o telefone "+r),e!=r&&(d=Database.child("/administradores/"+e),d.remove())):Database.child("administradores").child(r).once("value",function(e){e.exists()?Notificacao("Ja existe um(a) administrador(a) com esse telefone"):(d=Database.child("/administradores/"+r),d.set(l),Registrar("O(a) administrador(a) "+Vue.UserName+" ("+Vue.UserGroup+") adicionou o(a) administrador(a) "+t.value+" ("+n.value+") com a nota "+i.value+" e com o telefone "+r))}),s.src=GalleryImage,ChangePage(AdministradoresPagina)}}function RemoverLinha(e){document.querySelector("tr[data-key='"+e.key+"']").remove()}function MostrarEsconder(e,t){e.style.display="block",t.style.display="none"}function SetAdminPage(){Vue.AdminPage=null==GET.p?"menu":GET.p;let e=document.getElementById(Vue.AdminPage);e?document.getElementById(Vue.AdminPage).style.display="block":(document.getElementById("menu").style.display="block",Vue.AdminPage="menu"),document.getElementById(Vue.AdminPage+"-url").className="active"}function SetStudentPage(){"alunos-adicionar"==GET.p&&GET.q}function ChangePage(e){$("main").children().hide(),$(e).show(),CreateTable()}function Registrar(e){Vue.HasWrite?Database.child("/registros/").push().set({registro:e,timestamp:Date.now()}):Notificacao("Usuário não tem permissão de administrador(a)")}function Notificacao(e){M.toast({html:e})}function ChecarTimestamp(e){let t=(new Date).getTime()-e.val().timestamp;t<=1e3&&(Notificacao(e.val().registro),NotificacaoDesktop(e.val().registro),NotificacaoCordova(e.val().registro))}function LoginRecaptcha(){window.RecaptchaVerificador=new firebase.auth.RecaptchaVerifier("telefone-button",{size:"invisible",callback:function(e){LoginTelefone()}}),RecaptchaVerificador.render().then(function(e){window.RecaptchaWidgetID=e})}function LoginTelefone(){let e=document.getElementById("telefone-input").value,t=window.RecaptchaVerificador;firebase.auth().signInWithPhoneNumber(e,t).then(function(e){window.RecaptchaResultado=e,ChangePage("#senha"),Notificacao("Uma nova senha foi enviada para o seu telefone"),console.log(e)}).catch(function(e){window.RecaptchaVerificador.render().then(function(e){grecaptcha.reset(e)}),Notificacao("Houve um erro ao enviar a senha para o seu telefone"),console.error(e)})}function LoginSenha(){let e=document.getElementById("senha-input").value;RecaptchaResultado.confirm(e).then(function(e){Notificacao("Conectado com sucesso"),console.log(e)}).catch(function(e){Notificacao("Erro ao conectar"),console.error(e)})}function LoginDeslogar(){firebase.auth().signOut().then(function(e){Notificacao("Deslogado com sucesso"),console.log(e)}).catch(function(e){Notificacao("Erro ao deslogar"),console.error(e)})}function LoginRedirecionar(){if("login"==Vue.Page&&(Vue.HasLogin?window.location.href="/dashboard":LoginRecaptcha()),"dashboard"==Vue.Page)if(Vue.HasLogin){switch(SetAdminPage(),Vue.AdminPage){case"alunos":TabelaAlunos();break;case"registros":TabelaRegistros();break;case"administradores":TabelaAdministradores()}SetEditor()}else window.location.href="/login"}function LoginChecar(){firebase.auth().onAuthStateChanged(function(e){if(e){Vue.HasLogin=!0,Database.child("administradores").child(e.phoneNumber).on("value",function(t){t.exists()?(Vue.HasWrite=!0,Vue.UserName=t.val().nome,Vue.UserNote=t.val().nota,Vue.UserGroup=t.val().grupo,$("#loading-dashboard").hide(),$("#app").show()):Database.child("alunos").child(e.phoneNumber).on("value",function(e){e.exists()?(Vue.HasWrite=!1,Vue.UserName=e.val().nome,Vue.UserNote=e.val().nota,Vue.UserGroup=e.val().grupo,$("#loading-dashboard").hide(),$("#app").show()):(Notificacao("Tentativa de acesso não autorizada foi detectada"),LoginDeslogar())})}),Vue.UserId=e.uid,Vue.UserNumber=e.phoneNumber;let t="https://acaofilosofica.com/api/checkuser?id="+Vue.UserId+"&phone="+Vue.UserNumber,a=new XMLHttpRequest;a.open("GET",t,!0),a.onload=function(e){4===a.readyState&&(200===a.status?console.log(a.responseText):console.error(a.statusText))},a.onerror=function(e){console.error(a.statusText)},a.send(null)}else Vue.HasLogin=!1;LoginRedirecionar()})}function AudioHover(e,t){t?$("audio")[e].play():$("audio")[e].pause()}function MudarInput(e,t,a,o){for(i=0;i<o.length;i++)$(e).val()==t?("number"==document.querySelector(o[i]).type&&(document.querySelector(o[i]).type="text"),$(o[i]).val(a)):("text"==document.querySelector(o[i]).type&&(document.querySelector(o[i]).type="number"),$(o[i]).val($(o[i]).attr("data-value")))}function NotificacaoDesktop(e){notify.authorize(),notify.show(e)}function NomeMask(e){if(null!=e&&""!=e){let t=e.toLowerCase().trim(),a=t.split(" ");for(let e=0;e<a.length;e++){let t=a[e],o=t[0];t=t.length>2?o.toUpperCase()+t.slice(1):o+t.slice(1),a[e]=t}return a.join(" ")}}function Cordova(){window.hasOwnProperty("cordova")&&(document.addEventListener("deviceready",onDeviceReady,!1),eval("require('https://raw.githubusercontent.com/katzer/cordova-plugin-background-mode/master/www/background-mode.js')"),eval("require('https://raw.githubusercontent.com/katzer/cordova-plugin-local-notifications/master/www/local-notification.js')"),cordova.plugins.backgroundMode.enable(),cordova.plugins.backgroundMode.setDefaults({silent:!0}))}function NotificacaoCordova(e){window.hasOwnProperty("cordova")&&cordova.plugins.notification.local.schedule({title:"DEAF",text:e,foreground:!0})}function LoadIframe(){let e=document.getElementsByTagName("iframe");for(let t=0;t<e.length;t++)e[t].getAttribute("data-src")&&e[t].setAttribute("src",e[t].getAttribute("data-src"))}function DestroyTable(){$("table").DataTable().destroy()}function CreateTable(){$("table").DataTable({language:{sEmptyTable:"Nenhum registro encontrado",sInfo:"Mostrando de _START_ até _END_ de _TOTAL_ registros",sInfoEmpty:"Mostrando 0 até 0 de 0 registros",sInfoFiltered:"(Filtrados de _MAX_ registros)",sInfoPostFix:"",sInfoThousands:".",sLengthMenu:"_MENU_ resultados por página",sLoadingRecords:"Carregando...",sProcessing:"Processando...",sZeroRecords:"Nenhum registro encontrado",sSearch:"",oPaginate:{sNext:"Próximo",sPrevious:"Anterior",sFirst:"Primeiro",sLast:"Último"},oAria:{sSortAscending:": Ordenar colunas de forma ascendente",sSortDescending:": Ordenar colunas de forma descendente"}},searching:!0,ordering:!0,info:!1,lengthChange:!1,autoWidth:!1,responsive:!0}).columns.adjust().responsive.recalc(),$.fn.dataTable.ext.errMode="none"}function SetEditor(){let e=new Quill("#editor",{theme:"snow"});e.on("text-change",function(){e.root.innerHTML})}function ListarPostagem(e){let t=e.val(),a=document.createElement("tr"),o=document.createElement("td"),n=document.createElement("td"),i=document.createElement("td"),r=document.createElement("button"),s=document.createElement("td"),d=document.createElement("button");o.innerHTML=t.texto,n.innerHTML=new Date(t.timestamp).toLocaleString(),i.append(r),s.append(d),a.append(o),a.append(n),a.append(i),a.append(s),a.setAttribute("data-key",e.key),PostagensLista.append(a)}function MostrarPostagem(e){let t=e;Database.child("/postagens/"+t);PostagemPagina.setAttribute("data-key",t),ChangePage(PostagemPagina),PostagensDados.on("value",e=>{let t=e.val(),a=document.getElementById("postagem-titulo"),o=(document.getElementById("postagem-editor"),document.getElementById("postagem-foto-imagem"));a.value=t.titulo,o.setAttribute("src",t.foto),""!=t.foto&&null!=t.foto||o.setAttribute("src",GalleryImage)})}function EditarPostagem(){let e=AdministradorPagina.getAttribute("data-key"),t=document.getElementById("administrador-nome"),a=document.getElementById("administrador-ano"),o=document.getElementById("administrador-colegio"),n=document.getElementById("administrador-grupo"),i=document.getElementById("administrador-nota"),r="+"+document.getElementById("administrador-telefone").value.replace(/[^0-9]/g,""),s=document.getElementById("administrador-foto-imagem");if(s.src!=LoadingImage){let d,l={nome:NomeMask(t.value),ano:a.value,colegio:o.value,grupo:n.value,nota:i.value,foto:s.src};null!=e&&"null"!=e?(d=Database.child("/administradores/"+r),d.update(l),Registrar("O(a) administrador "+Vue.UserName+" ("+Vue.UserGroup+") atualizou o(a) administrador "+t.value+" ("+n.value+") com o telefone "+r),e!=r&&(d=Database.child("/administradores/"+e),d.remove())):Database.child("administradores").child(r).once("value",function(e){e.exists()?Notificacao("Ja existe um administrador(a) com esse telefone"):(d=Database.child("/administradores/"+r),d.set(l),Registrar("O(a) administrador "+Vue.UserName+" ("+Vue.UserGroup+") adicionou o(a) administrador "+t.value+" ("+n.value+") com o telefone "+r))}),s.src=GalleryImage,ChangePage(AdministradoresPagina)}}function ResizeTable(){$("table").DataTable().columns.adjust().responsive.recalc(),$.fn.dataTable.ext.errMode="none"}function Update(){$(".dataTables_filter").removeClass("dataTables_filter").css("padding","5px").append("<i class='material-icons' style='bottom: 4vh; position: relative; float: right;'>search</i>"),$(".paginate_button").addClass("btn").removeClass("paginate_button").css("margin","5px"),requestAnimationFrame(Update)}function CheckURL(e,t){void 0!==GET.p?e.href!==window.location.href&&e.href+"#"!==window.location.href||(e.href="#"):0===t&&(e.href="#")}var Vue=new Vue({el:"#app",data:{Page:location.pathname.split("/").slice(-1)[0].replace(".html",""),AdminPage:"menu",HasLogin:!1,HasWrite:!1,UserId:"",UserName:"Usuário",UserNumber:"Telefone",UserNote:"∞",UserGroup:"Grupo",VideoRandom:"https://www.youtube.com/embed?listType=playlist&list=PLwxNMb28XmpeypJMHfNbJ4RAFkRtmAN3P&fs=0&rel=0&showinfo=0&showsearch=0&controls=0&modestbranding=0&autohide=1&autoplay=0&loop=1&disablekb=1&cc_load_policy=1&iv_load_policy=3&cc_lang_pref=pt&origin=https://acaofilosofica.com&index="+Math.floor(34*Math.random())}});M.AutoInit(),LoginChecar();const Performance=firebase.performance(),Storage=firebase.storage().ref(),Database=firebase.database().ref(),AlunoPagina=document.getElementById("aluno"),Alunos=document.getElementById("alunos"),AlunosDados=Database.child("alunos"),AlunosLista=document.getElementById("alunos-lista"),AdministradorPagina=document.getElementById("administrador"),AdministradoresPagina=document.getElementById("administradores"),AdministradoresDados=Database.child("administradores"),AdministradoresLista=document.getElementById("administradores-lista"),REGISTROS_DATABASE=Database.child("registros"),REGISTROS_LIST=document.getElementById("registros-lista"),PostagensDados=Database.child("postagens"),PostagensLista=document.getElementById("postagens-lista"),GalleryImage="/assets/image/gallery.webp",LoadingImage="/assets/image/loading.webp";REGISTROS_DATABASE.endAt().limitToLast(1).on("child_added",e=>{ChecarTimestamp(e)});var GET=function(e){if(""==e)return{};let t={};for(let a=0;a<e.length;++a){let o=e[a].split("=",2);1==o.length?t[o[0]]="":t[o[0]]=decodeURIComponent(o[1].replace(/\+/g," "))}return t}(window.location.search.substr(1).split("&"));window.onload=function(){"dashboard"!=Vue.Page&&($("#loading").hide(),$("#app").show()),LoadIframe(),CreateTable();let e=[...document.getElementsByClassName("url")];e.forEach(CheckURL),$("#"+Vue.AdminPage+"-url a").on("click",function(){ChangePage("#"+Vue.AdminPage)})},window.notify={list:[],id:0,compatible:function(){return"undefined"!=typeof Notification||(console.log("Notifications are not available for your browser."),!1)},authorize:function(){notify.compatible()&&Notification.requestPermission(function(e){console.log("Permission to display: "+e)})},showDelayed:function(e){console.log("A notification will be triggered in "+e+" seconds. Try minimising the browser now."),setTimeout(notify.show,1e3*e)},show:function(e){if("undefined"!=typeof Notification){if(notify.compatible()){notify.id++;let t=notify.id;notify.list[t]=new Notification("DEAF - Ação Filosófica",{body:e,tag:t,icon:"/assets/image/icon.png",lang:"",dir:"auto"}),console.log("Notification #"+t+" queued for display"),notify.list[t].onclick=function(){notify.logEvent(t,"clicked")},notify.list[t].onshow=function(){notify.logEvent(t,"showed")},notify.list[t].onerror=function(){notify.logEvent(t,"errored")},notify.list[t].onclose=function(){notify.logEvent(t,"closed")},console.log("Created a new notification ..."),console.log(notify.list[t])}}else notify.log("Notifications are not available for your browser.")},logEvent:function(e,t){console.log("Notification #"+e+" "+t)}},Cordova(),$("img.lazy").Lazy(),requestAnimationFrame(Update),$("#administradores-lista").on("click",".administrador-mostrar-button",function(){MostrarAdministrador($(this).attr("data-key"))}),$("#administradores-lista").on("click",".administrador-deletar-button",function(){DeletarAdministrador($(this).attr("data-key"),$(this).attr("data-path"))}),$("#alunos-lista").on("click",".aluno-mostrar-button",function(){MostrarAluno($(this).attr("data-key"))}),$("#alunos-lista").on("click",".aluno-deletar-button",function(){DeletarAluno($(this).attr("data-key",$(this).attr("data-path")))}),$("table").on("page",ResizeTable),$("table").on("search",ResizeTable),$("table").on("column-sizing",ResizeTable),$("table").on("responsive-resize",ResizeTable),$(".phone-input").mask("+55 (73) N ZZZZ-ZZZZ",{translation:{N:{pattern:/9/,fallback:9},Z:{pattern:/[0-9]/}},keepStatic:!0}),window.onresize=function(){ResizeTable()};